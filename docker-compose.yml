services:
  agent-ingest:
    build: .
    image: sammascanner/wazuh-agent:ingets_0.2
    ports: 
      - "9000:9000"
    volumes:
      -  ./code:/var/ossec/wodles/code
    environment:
      - "MANAGER_URL=${MANAGER_URL:?MANAGER_URL is required}"
      - "MANAGER_PORT=${MANAGER_PORT:?MANAGER_PORT is required}"
      - "SERVER_URL=${SERVER_URL:?SERVER_URL is required}"
      - "SERVER_PORT=${SERVER_PORT:?SERVER_PORT is required}"
      - "NAME=${NAME:?NAME is required}"
      - "GROUP=${GROUP:?GROUP is required}"
      - "ENROL_TOKEN=${ENROL_TOKEN:?ENROL_TOKEN is required}"
      - "API_KEY=${API_KEY:?API_KEY is required}" # REQUIRED: set in server environment
      - "WAZUH_DECODER_HEADER=1:Wazuh-AWS:" # Optional: Header for log ingestion
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  agent-regular:
    build:
      dockerfile: Dockerfile.agent
    image: sammascanner/wazuh-agent:regular_0.2
    ports: 
      - "9001:9000"
    volumes:
      -  ./code:/var/ossec/wodles/code
    environment:
      - "MANAGER_URL=${MANAGER_URL:?MANAGER_URL is required}"
      - "MANAGER_PORT=${MANAGER_PORT:?MANAGER_PORT is required}"
      - "SERVER_URL=${SERVER_URL:?SERVER_URL is required}"
      - "SERVER_PORT=${SERVER_PORT:?SERVER_PORT is required}"
      - "NAME=${NAME:?NAME is required}"
      - "GROUP=${GROUP:?GROUP is required}"
      - "ENROL_TOKEN=${ENROL_TOKEN:?ENROL_TOKEN is required}"
